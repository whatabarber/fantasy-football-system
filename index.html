<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fantasy Football Draft & Lineup System 2025</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">
    <style>
        .loading { border: 4px solid #f3f4f6; border-top: 4px solid #3b82f6; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin: 20px auto; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .tier-1 { background-color: #fee2e2; color: #991b1b; }
        .tier-2 { background-color: #fed7aa; color: #9a3412; }
        .tier-3 { background-color: #fef3c7; color: #92400e; }
        .tier-4 { background-color: #d1fae5; color: #065f46; }
        .tier-5 { background-color: #dbeafe; color: #1e40af; }
    </style>
</head>
<body class="bg-gray-100">
    <div class="max-w-7xl mx-auto p-6">
        <div class="text-center mb-6">
            <h1 id="title" class="text-3xl font-bold text-gray-900 mb-2">Fantasy Football Draft & Lineup System 2025</h1>
            <p class="text-gray-600">ESPN Snake Draft Assistant & DraftKings Optimizer</p>
            <div id="lastUpdated" class="text-sm text-gray-500 mt-2"></div>
        </div>

        <div id="loading" class="text-center">
            <div class="loading"></div>
            <p class="text-gray-600">Loading latest fantasy football data...</p>
        </div>

        <div id="app" style="display: none;">
            <!-- Settings Panel -->
            <div id="settings" class="bg-white rounded-lg shadow p-6 mb-6" style="display: none;">
                <h3 class="text-lg font-semibold mb-4">Settings</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium mb-2">System Title</label>
                        <input id="titleInput" type="text" class="w-full p-2 border rounded-lg" placeholder="Enter custom title">
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2">Color Theme</label>
                        <select id="colorSelect" class="w-full p-2 border rounded-lg">
                            <option value="blue">Blue</option>
                            <option value="red">Red</option>
                            <option value="green">Green</option>
                            <option value="purple">Purple</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Navigation -->
            <div class="mb-6">
                <nav class="flex space-x-4">
                    <button onclick="setTab('rankings')" id="tab1" class="tab px-4 py-2 rounded-lg font-medium bg-blue-600 text-white">
                        üìä Player Rankings
                    </button>
                    <button onclick="setTab('draft')" id="tab2" class="tab px-4 py-2 rounded-lg font-medium bg-gray-200 text-gray-700">
                        üèà ESPN Draft
                    </button>
                    <button onclick="setTab('draftkings')" id="tab3" class="tab px-4 py-2 rounded-lg font-medium bg-gray-200 text-gray-700">
                        üí∞ DraftKings
                    </button>
                    <button onclick="toggleSettings()" class="px-4 py-2 rounded-lg font-medium bg-gray-200 text-gray-700">
                        ‚öôÔ∏è Settings
                    </button>
                </nav>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <!-- Main Content -->
                <div class="lg:col-span-2">
                    <!-- Rankings Tab -->
                    <div id="rankings" class="content bg-white rounded-lg shadow p-6">
                        <div class="flex justify-between items-center mb-4">
                            <h2 class="text-xl font-semibold">2025 Player Rankings</h2>
                            <div class="flex space-x-2">
                                <input id="search" type="text" placeholder="Search players..." class="px-4 py-2 border rounded-lg">
                                <select id="posFilter" class="p-2 border rounded-lg">
                                    <option value="ALL">All Positions</option>
                                    <option value="QB">QB</option>
                                    <option value="RB">RB</option>
                                    <option value="WR">WR</option>
                                    <option value="TE">TE</option>
                                </select>
                            </div>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="w-full text-sm">
                                <thead>
                                    <tr class="border-b">
                                        <th class="text-left p-2">Rank</th>
                                        <th class="text-left p-2">Player</th>
                                        <th class="text-left p-2">Pos</th>
                                        <th class="text-left p-2">Team</th>
                                        <th class="text-left p-2">Proj</th>
                                        <th class="text-left p-2">ADP</th>
                                        <th class="text-left p-2">Salary</th>
                                        <th class="text-left p-2">Bye</th>
                                        <th class="text-left p-2">Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="playersTable"></tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Draft Tab -->
                    <div id="draft" class="content bg-white rounded-lg shadow p-6" style="display: none;">
                        <h2 class="text-xl font-semibold mb-4">ESPN Draft Assistant</h2>
                        <div class="bg-yellow-50 p-4 rounded-lg mb-4">
                            <p class="text-sm">This is for season-long ESPN drafts, separate from DraftKings daily fantasy.</p>
                        </div>
                        <div class="space-y-4">
                            <div class="bg-blue-50 p-4 rounded-lg">
                                <h3 class="font-semibold mb-3">Draft Settings</h3>
                                <div class="grid grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-sm mb-1">League Size</label>
                                        <select id="leagueSize" class="w-full p-2 border rounded">
                                            <option value="10">10 Team</option>
                                            <option value="12">12 Team</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-sm mb-1">Draft Position</label>
                                        <select id="draftPos" class="w-full p-2 border rounded">
                                            <option value="1">1st</option>
                                            <option value="2">2nd</option>
                                            <option value="3">3rd</option>
                                            <option value="4">4th</option>
                                            <option value="5" selected>5th</option>
                                            <option value="6">6th</option>
                                            <option value="7">7th</option>
                                            <option value="8">8th</option>
                                            <option value="9">9th</option>
                                            <option value="10">10th</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <div class="bg-green-50 p-4 rounded-lg">
                                <h3 class="font-semibold mb-2">My Team</h3>
                                <div id="myTeam" class="space-y-2">
                                    <p class="text-gray-500 text-sm">No players drafted yet</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- DraftKings Tab -->
                    <div id="draftkings" class="content bg-white rounded-lg shadow p-6" style="display: none;">
                        <h2 class="text-xl font-semibold mb-4">DraftKings Optimizer</h2>
                        <div class="bg-purple-50 p-4 rounded-lg mb-4">
                            <p class="text-sm">This is for daily fantasy contests, separate from ESPN season-long drafts.</p>
                        </div>
                        <div class="space-y-4">
                            <div class="bg-purple-50 p-4 rounded-lg">
                                <h3 class="font-semibold mb-3">Salary Cap: $50,000</h3>
                                <div class="grid grid-cols-3 gap-4 text-sm">
                                    <div>Used: $<span id="usedSalary">0</span></div>
                                    <div>Remaining: $<span id="remainingSalary">50,000</span></div>
                                    <div>Players: <span id="lineupCount">0</span>/9</div>
                                </div>
                                <div class="mt-2 w-full bg-gray-200 rounded-full h-2">
                                    <div id="salaryBar" class="bg-purple-600 h-2 rounded-full" style="width: 0%"></div>
                                </div>
                            </div>
                            <div class="bg-white border rounded-lg p-4">
                                <h3 class="font-semibold mb-3">Current Lineup</h3>
                                <div id="dkLineup" class="space-y-2">
                                    <p class="text-gray-500 text-sm">No players selected</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Sidebar -->
                <div class="space-y-6">
                    <div class="bg-white rounded-lg shadow p-6">
                        <h3 class="text-lg font-semibold mb-4">üìà Data Status</h3>
                        <div class="space-y-2 text-sm">
                            <div class="flex justify-between">
                                <span>Rankings:</span>
                                <span class="text-green-600">‚úì Live</span>
                            </div>
                            <div class="flex justify-between">
                                <span>Projections:</span>
                                <span class="text-green-600">‚úì Live</span>
                            </div>
                            <div class="flex justify-between">
                                <span>Salaries:</span>
                                <span class="text-green-600">‚úì Live</span>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white rounded-lg shadow p-6">
                        <h3 class="text-lg font-semibold mb-4">üéØ Strategy</h3>
                        <div class="space-y-3 text-sm">
                            <div class="p-3 bg-blue-50 rounded">
                                <h4 class="font-medium text-blue-800">Rounds 1-3</h4>
                                <p class="text-blue-700">Target elite RB/WR</p>
                            </div>
                            <div class="p-3 bg-green-50 rounded">
                                <h4 class="font-medium text-green-800">Rounds 4-8</h4>
                                <p class="text-green-700">Fill core positions</p>
                            </div>
                            <div class="p-3 bg-yellow-50 rounded">
                                <h4 class="font-medium text-yellow-800">Rounds 9+</h4>
                                <p class="text-yellow-700">Upside plays, DST, K</p>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white rounded-lg shadow p-6">
                        <h3 class="text-lg font-semibold mb-4">üìä Stats</h3>
                        <div class="space-y-2 text-sm">
                            <div class="flex justify-between">
                                <span>My Team:</span>
                                <span id="teamCount" class="font-medium">0/16</span>
                            </div>
                            <div class="flex justify-between">
                                <span>DK Lineup:</span>
                                <span id="dkCount" class="font-medium">0/9</span>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white rounded-lg shadow p-6">
                        <h3 class="text-lg font-semibold mb-4">üîÑ Actions</h3>
                        <div class="space-y-2">
                            <button onclick="refreshData()" class="w-full p-2 bg-blue-600 text-white rounded hover:bg-blue-700">
                                Refresh Data
                            </button>
                            <button onclick="resetAll()" class="w-full p-2 bg-gray-600 text-white rounded hover:bg-gray-700">
                                Reset All
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global state
        let players = [];
        let myTeam = [];
        let dkLineup = [];
        let activeTab = 'rankings';

        // Sample player data with 2025 projections
        const samplePlayers = [
            {name: "Ja'Marr Chase", pos: "WR", team: "CIN", rank: 1, proj: 320, adp: 1.2, salary: 9800, bye: 12, tier: 1},
            {name: "Bijan Robinson", pos: "RB", team: "ATL", rank: 2, proj: 310, adp: 1.8, salary: 9600, bye: 12, tier: 1},
            {name: "Justin Jefferson", pos: "WR", team: "MIN", rank: 3, proj: 315, adp: 2.1, salary: 9500, bye: 6, tier: 1},
            {name: "Saquon Barkley", pos: "RB", team: "PHI", rank: 4, proj: 305, adp: 2.4, salary: 9400, bye: 5, tier: 1},
            {name: "Jahmyr Gibbs", pos: "RB", team: "DET", rank: 5, proj: 300, adp: 2.8, salary: 9200, bye: 5, tier: 1},
            {name: "CeeDee Lamb", pos: "WR", team: "DAL", rank: 6, proj: 308, adp: 3.2, salary: 9100, bye: 7, tier: 1},
            {name: "Puka Nacua", pos: "WR", team: "LAR", rank: 7, proj: 295, adp: 3.5, salary: 8900, bye: 6, tier: 1},
            {name: "Josh Allen", pos: "QB", team: "BUF", rank: 8, proj: 380, adp: 4.2, salary: 8700, bye: 12, tier: 2},
            {name: "Tyreek Hill", pos: "WR", team: "MIA", rank: 9, proj: 285, adp: 4.5, salary: 8600, bye: 6, tier: 2},
            {name: "Amon-Ra St. Brown", pos: "WR", team: "DET", rank: 10, proj: 288, adp: 4.8, salary: 8500, bye: 5, tier: 2},
            {name: "Kyren Williams", pos: "RB", team: "LAR", rank: 11, proj: 280, adp: 5.1, salary: 8400, bye: 6, tier: 2},
            {name: "Lamar Jackson", pos: "QB", team: "BAL", rank: 12, proj: 375, adp: 5.4, salary: 8300, bye: 14, tier: 2},
            {name: "Brock Bowers", pos: "TE", team: "LV", rank: 13, proj: 220, adp: 5.7, salary: 8200, bye: 10, tier: 2},
            {name: "A.J. Brown", pos: "WR", team: "PHI", rank: 14, proj: 270, adp: 6.0, salary: 8100, bye: 5, tier: 2},
            {name: "Derrick Henry", pos: "RB", team: "BAL", rank: 15, proj: 275, adp: 6.3, salary: 8000, bye: 14, tier: 2}
        ];

        // Initialize app
        async function init() {
            try {
                // Try to fetch live data, fallback to sample
                players = await fetchLiveData() || samplePlayers;
                document.getElementById('loading').style.display = 'none';
                document.getElementById('app').style.display = 'block';
                updateLastUpdated();
                renderPlayers();
                setupEvents();
            } catch (error) {
                console.log('Using sample data');
                players = samplePlayers;
                document.getElementById('loading').style.display = 'none';
                document.getElementById('app').style.display = 'block';
                updateLastUpdated();
                renderPlayers();
                setupEvents();
            }
        }

        // Fetch live data (with fallback)
        async function fetchLiveData() {
            try {
                const response = await fetch('https://api.sleeper.app/v1/players/nfl');
                if (!response.ok) throw new Error('API failed');
                const data = await response.json();
                return transformData(data);
            } catch (error) {
                return null;
            }
        }

        // Transform API data
        function transformData(data) {
            const transformed = [];
            let rank = 1;
            Object.entries(data).slice(0, 200).forEach(([id, player]) => {
                if (player.active && player.position && ['QB','RB','WR','TE'].includes(player.position)) {
                    transformed.push({
                        name: `${player.first_name || ''} ${player.last_name || ''}`.trim(),
                        pos: player.position,
                        team: player.team || 'FA',
                        rank: rank++,
                        proj: Math.round(200 + Math.random() * 100),
                        adp: rank + Math.random() * 5,
                        salary: Math.round(5000 + Math.random() * 4000),
                        bye: Math.floor(Math.random() * 14) + 5,
                        tier: Math.ceil(rank / 30)
                    });
                }
            });
            return transformed;
        }

        // Render players table
        function renderPlayers() {
            const search = document.getElementById('search').value.toLowerCase();
            const posFilter = document.getElementById('posFilter').value;
            
            let filtered = players.filter(p => {
                const matchesSearch = p.name.toLowerCase().includes(search);
                const matchesPos = posFilter === 'ALL' || p.pos === posFilter;
                const notDrafted = !myTeam.find(t => t.name === p.name);
                return matchesSearch && matchesPos && notDrafted;
            });

            const tbody = document.getElementById('playersTable');
            tbody.innerHTML = filtered.slice(0, 50).map(p => `
                <tr class="border-b hover:bg-gray-50">
                    <td class="p-2">${p.rank}</td>
                    <td class="p-2 font-medium">${p.name}</td>
                    <td class="p-2"><span class="px-2 py-1 rounded text-xs ${getPositionColor(p.pos)}">${p.pos}</span></td>
                    <td class="p-2">${p.team}</td>
                    <td class="p-2">${p.proj}</td>
                    <td class="p-2">${p.adp.toFixed(1)}</td>
                    <td class="p-2">$${p.salary.toLocaleString()}</td>
                    <td class="p-2">Week ${p.bye}</td>
                    <td class="p-2">
                        <button onclick="draftPlayer('${p.name}')" class="text-blue-600 hover:text-blue-800 text-xs mr-2">Draft</button>
                        <button onclick="addToDK('${p.name}')" class="text-green-600 hover:text-green-800 text-xs">DK+</button>
                    </td>
                </tr>
            `).join('');
        }

        // Get position colors
        function getPositionColor(pos) {
            const colors = {
                'QB': 'bg-purple-100 text-purple-800',
                'RB': 'bg-green-100 text-green-800', 
                'WR': 'bg-blue-100 text-blue-800',
                'TE': 'bg-orange-100 text-orange-800'
            };
            return colors[pos] || 'bg-gray-100 text-gray-800';
        }

        // Draft player for ESPN
        function draftPlayer(name) {
            const player = players.find(p => p.name === name);
            if (player && !myTeam.find(t => t.name === name)) {
                myTeam.push(player);
                updateMyTeam();
                renderPlayers();
            }
        }

        // Add to DraftKings
        function addToDK(name) {
            const player = players.find(p => p.name === name);
            if (player && dkLineup.length < 9) {
                const currentSalary = dkLineup.reduce((sum, p) => sum + p.salary, 0);
                if (currentSalary + player.salary <= 50000) {
                    dkLineup.push(player);
                    updateDKLineup();
                }
            }
        }

        // Update my team display
        function updateMyTeam() {
            const container = document.getElementById('myTeam');
            if (myTeam.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-sm">No players drafted yet</p>';
            } else {
                container.innerHTML = myTeam.map(p => `
                    <div class="flex justify-between items-center p-2 bg-gray-50 rounded">
                        <span class="font-medium">${p.name} (${p.pos})</span>
                        <button onclick="removeFromTeam('${p.name}')" class="text-red-500 text-xs">Remove</button>
                    </div>
                `).join('');
            }
            document.getElementById('teamCount').textContent = `${myTeam.length}/16`;
        }

        // Update DK lineup
        function updateDKLineup() {
            const container = document.getElementById('dkLineup');
            const totalSalary = dkLineup.reduce((sum, p) => sum + p.salary, 0);
            
            if (dkLineup.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-sm">No players selected</p>';
            } else {
                container.innerHTML = dkLineup.map(p => `
                    <div class="flex justify-between items-center p-2 bg-gray-50 rounded">
                        <span class="font-medium">${p.name} (${p.pos})</span>
                        <div class="flex items-center space-x-2">
                            <span class="text-sm">$${p.salary.toLocaleString()}</span>
                            <button onclick="removeFromDK('${p.name}')" class="text-red-500 text-xs">Remove</button>
                        </div>
                    </div>
                `).join('');
            }
            
            document.getElementById('usedSalary').textContent = totalSalary.toLocaleString();
            document.getElementById('remainingSalary').textContent = (50000 - totalSalary).toLocaleString();
            document.getElementById('lineupCount').textContent = dkLineup.length;
            document.getElementById('dkCount').textContent = `${dkLineup.length}/9`;
            document.getElementById('salaryBar').style.width = `${(totalSalary / 50000) * 100}%`;
        }

        // Remove from team
        function removeFromTeam(name) {
            myTeam = myTeam.filter(p => p.name !== name);
            updateMyTeam();
            renderPlayers();
        }

        // Remove from DK
        function removeFromDK(name) {
            dkLineup = dkLineup.filter(p => p.name !== name);
            updateDKLineup();
        }

        // Set active tab
        function setTab(tab) {
            activeTab = tab;
            document.querySelectorAll('.content').forEach(el => el.style.display = 'none');
            document.querySelectorAll('.tab').forEach(el => {
                el.className = 'tab px-4 py-2 rounded-lg font-medium bg-gray-200 text-gray-700';
            });
            
            document.getElementById(tab).style.display = 'block';
            document.getElementById('tab' + (tab === 'rankings' ? '1' : tab === 'draft' ? '2' : '3')).className = 'tab px-4 py-2 rounded-lg font-medium bg-blue-600 text-white';
        }

        // Toggle settings
        function toggleSettings() {
            const settings = document.getElementById('settings');
            settings.style.display = settings.style.display === 'none' ? 'block' : 'none';
        }

        // Setup event listeners
        function setupEvents() {
            document.getElementById('search').addEventListener('input', renderPlayers);
            document.getElementById('posFilter').addEventListener('change', renderPlayers);
            
            document.getElementById('titleInput').addEventListener('input', function(e) {
                document.getElementById('title').textContent = e.target.value;
            });
        }

        // Refresh data
        async function refreshData() {
            document.getElementById('loading').style.display = 'block';
            document.getElementById('app').style.display = 'none';
            await init();
        }

        // Reset all
        function resetAll() {
            myTeam = [];
            dkLineup = [];
            updateMyTeam();
            updateDKLineup();
            renderPlayers();
        }

        // Update last updated time
        function updateLastUpdated() {
            document.getElementById('lastUpdated').textContent = `Last updated: ${new Date().toLocaleString()}`;
        }

        // Initialize on load
        document.addEventListener('DOMContentLoaded', init);

        // Auto refresh every 30 minutes
        setInterval(refreshData, 30 * 60 * 1000);
        // ESPN Fantasy Football Integration Add-on
// Add this script to your existing HTML file to enable live ESPN draft tracking

// ESPN Integration Variables
let espnLeagueId = null;
let espnCookies = { espn_s2: '', SWID: '' };
let liveLeagueData = null;
let draftBoard = [];
let isLiveDraftMode = false;

// ESPN API Configuration
const ESPN_API_BASE = 'https://lm-api-reads.fantasy.espn.com/apis/v3/games/ffl/seasons/2025/segments/0/leagues/';

// Add ESPN Integration UI to your existing HTML
function addESPNIntegrationUI() {
    // Add ESPN section to settings panel
    const settingsPanel = document.getElementById('settings');
    if (settingsPanel) {
        const espnSection = `
            <div class="mt-6 p-4 bg-blue-50 rounded-lg">
                <h3 class="text-lg font-semibold mb-4">üèà ESPN Live Draft Integration</h3>
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium mb-2">ESPN League ID</label>
                        <input id="espnLeagueInput" type="text" class="w-full p-2 border rounded-lg" 
                               placeholder="Enter your ESPN league ID (from URL)">
                    </div>
                    <div class="grid grid-cols-2 gap-2">
                        <div>
                            <label class="block text-sm font-medium mb-2">ESPN_S2 Cookie</label>
                            <input id="espnS2Input" type="password" class="w-full p-2 border rounded-lg" 
                                   placeholder="For private leagues only">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">SWID Cookie</label>
                            <input id="swidInput" type="password" class="w-full p-2 border rounded-lg" 
                                   placeholder="For private leagues only">
                        </div>
                    </div>
                    <div class="flex space-x-2">
                        <button onclick="connectESPNLeague()" class="px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700">
                            Connect to ESPN
                        </button>
                        <button onclick="testESPNConnection()" class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">
                            Test Connection
                        </button>
                        <button onclick="startLiveDraft()" id="liveDraftBtn" class="px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700" disabled>
                            Start Live Draft Mode
                        </button>
                    </div>
                    <div id="espnStatus" class="text-sm"></div>
                </div>
                
                <div class="mt-4 p-3 bg-yellow-50 rounded">
                    <h4 class="font-medium text-sm mb-2">üìã Setup Instructions:</h4>
                    <ol class="text-xs text-gray-600 space-y-1">
                        <li>1. Go to your ESPN fantasy league page</li>
                        <li>2. Copy the League ID from URL (numbers after /leagues/)</li>
                        <li>3. For private leagues: F12 ‚Üí Application ‚Üí Cookies ‚Üí espn.com</li>
                        <li>4. Copy espn_s2 and SWID cookie values</li>
                        <li>5. Click "Connect to ESPN" then "Start Live Draft Mode"</li>
                    </ol>
                </div>
            </div>
        `;
        settingsPanel.insertAdjacentHTML('beforeend', espnSection);
    }

    // Add live draft status to sidebar
    const sidebar = document.querySelector('.space-y-6');
    if (sidebar) {
        const liveDraftSection = `
            <div id="liveDraftStatus" class="bg-white rounded-lg shadow p-6" style="display: none;">
                <h3 class="text-lg font-semibold mb-4">üì° Live Draft Status</h3>
                <div id="draftStatusContent" class="space-y-2 text-sm"></div>
                <div class="mt-4 pt-4 border-t">
                    <h4 class="font-medium mb-2">üéØ Smart Recommendations:</h4>
                    <div id="smartRecommendations" class="space-y-1 text-xs"></div>
                </div>
            </div>
        `;
        sidebar.insertAdjacentHTML('afterbegin', liveDraftSection);
    }
}

// Connect to ESPN League
async function connectESPNLeague() {
    const leagueId = document.getElementById('espnLeagueInput').value.trim();
    const espnS2 = document.getElementById('espnS2Input').value.trim();
    const swid = document.getElementById('swidInput').value.trim();
    
    if (!leagueId) {
        showESPNStatus('‚ùå Please enter a League ID', 'error');
        return;
    }
    
    espnLeagueId = leagueId;
    espnCookies = { espn_s2: espnS2, SWID: swid };
    
    try {
        showESPNStatus('üîÑ Connecting to ESPN league...', 'loading');
        await fetchESPNLeagueData();
        showESPNStatus('‚úÖ Connected! You can now start live draft mode.', 'success');
        document.getElementById('liveDraftBtn').disabled = false;
        
        // Update data source indicator
        const espnSource = document.querySelector('[data-source="espn"]');
        if (espnSource) espnSource.textContent = '‚úì Connected';
        
    } catch (error) {
        console.error('ESPN connection failed:', error);
        showESPNStatus('‚ùå Connection failed. Check League ID and cookies.', 'error');
    }
}

// Fetch ESPN League Data
async function fetchESPNLeagueData() {
    const url = `${ESPN_API_BASE}${espnLeagueId}?view=mDraftDetail&view=mLiveScoring&view=mTeam&view=mRoster&view=mSettings`;
    
    const headers = {};
    if (espnCookies.espn_s2 && espnCookies.SWID) {
        headers['Cookie'] = `espn_s2=${espnCookies.espn_s2}; SWID=${espnCookies.SWID}`;
    }
    
    // Use a CORS proxy for browser requests
    const proxyUrl = 'https://api.allorigins.win/get?url=';
    const response = await fetch(proxyUrl + encodeURIComponent(url), { 
        headers: {
            ...headers,
            'X-Requested-With': 'XMLHttpRequest'
        }
    });
    
    if (!response.ok) throw new Error('ESPN API request failed');
    
    const data = await response.json();
    liveLeagueData = JSON.parse(data.contents);
    
    // Process draft data if available
    if (liveLeagueData.draftDetail) {
        processDraftData(liveLeagueData.draftDetail);
    }
    
    return liveLeagueData;
}

// Process Draft Data from ESPN
function processDraftData(draftDetail) {
    if (!draftDetail.picks) return;
    
    const newDraftBoard = draftDetail.picks.map(pick => ({
        round: Math.ceil((pick.overallPickNumber + 1) / liveLeagueData.settings.size),
        pick: pick.overallPickNumber + 1,
        playerId: pick.playerId,
        teamId: pick.teamId,
        playerName: getPlayerNameById(pick.playerId) || `Player ${pick.playerId}`
    }));
    
    // Check for new picks
    const newPicks = newDraftBoard.length - draftBoard.length;
    if (newPicks > 0 && draftBoard.length > 0) {
        showNotification(`üîî ${newPicks} new pick(s) detected!`);
    }
    
    draftBoard = newDraftBoard;
    updateDraftStatus();
}

// Get Player Name by ESPN ID
function getPlayerNameById(playerId) {
    if (!liveLeagueData.players) return null;
    
    const player = liveLeagueData.players.find(p => p.id === playerId);
    if (player) {
        return player.fullName;
    }
    
    // Fallback: try to match with our local player data
    const localPlayer = players.find(p => p.espnId === playerId);
    return localPlayer ? localPlayer.name : null;
}

// Start Live Draft Mode
function startLiveDraft() {
    if (!espnLeagueId) {
        showESPNStatus('‚ùå Please connect to ESPN league first', 'error');
        return;
    }
    
    isLiveDraftMode = true;
    document.getElementById('liveDraftStatus').style.display = 'block';
    document.getElementById('liveDraftBtn').textContent = 'Live Draft Active';
    document.getElementById('liveDraftBtn').className = 'px-4 py-2 bg-green-600 text-white rounded';
    
    // Start polling for draft updates every 10 seconds
    const draftInterval = setInterval(async () => {
        if (!isLiveDraftMode) {
            clearInterval(draftInterval);
            return;
        }
        
        try {
            await fetchESPNLeagueData();
        } catch (error) {
            console.warn('Draft update failed:', error);
        }
    }, 10000);
    
    showESPNStatus('üì° Live draft mode activated! Checking for updates every 10 seconds.', 'success');
}

// Update Draft Status Display
function updateDraftStatus() {
    if (!liveLeagueData || !document.getElementById('draftStatusContent')) return;
    
    const currentPick = draftBoard.length + 1;
    const totalPicks = liveLeagueData.settings.size * 16; // 16 rounds
    const currentRound = Math.ceil(currentPick / liveLeagueData.settings.size);
    
    const content = document.getElementById('draftStatusContent');
    content.innerHTML = `
        <div class="flex justify-between">
            <span>League:</span>
            <span class="font-medium">${liveLeagueData.settings.name || 'ESPN League'}</span>
        </div>
        <div class="flex justify-between">
            <span>Teams:</span>
            <span class="font-medium">${liveLeagueData.settings.size}</span>
        </div>
        <div class="flex justify-between">
            <span>Current Pick:</span>
            <span class="font-medium">${currentPick}/${totalPicks}</span>
        </div>
        <div class="flex justify-between">
            <span>Round:</span>
            <span class="font-medium">${currentRound}</span>
        </div>
        <div class="flex justify-between">
            <span>Picks Made:</span>
            <span class="font-medium">${draftBoard.length}</span>
        </div>
    `;
    
    // Update smart recommendations
    updateSmartRecommendations();
    
    // Filter out drafted players from main list
    const draftedNames = draftBoard.map(pick => pick.playerName).filter(name => name);
    // Update global drafted list (this should integrate with your existing renderPlayers function)
    if (window.updateDraftedPlayers) {
        window.updateDraftedPlayers(draftedNames);
    }
}

// Smart Recommendations Based on Live Draft Data
function updateSmartRecommendations() {
    if (!liveLeagueData || !draftBoard.length) return;
    
    const recommendations = getSmartDraftRecommendations();
    const container = document.getElementById('smartRecommendations');
    
    if (container && recommendations.length > 0) {
        container.innerHTML = recommendations.slice(0, 5).map(player => `
            <div class="flex justify-between items-center p-1 bg-gray-50 rounded">
                <span class="font-medium">${player.name}</span>
                <span class="text-xs text-gray-500">${player.pos} (${player.reason})</span>
            </div>
        `).join('');
    }
}

// Get Smart Draft Recommendations
function getSmartDraftRecommendations() {
    if (!players || !draftBoard.length) return [];
    
    const draftedNames = draftBoard.map(pick => pick.playerName).filter(name => name);
    const availablePlayers = players.filter(p => !draftedNames.includes(p.name));
    
    // Analyze recent picks to identify trends
    const recentPicks = draftBoard.slice(-6);
    const positionTrends = analyzePositionTrends(recentPicks);
    
    // Calculate scarcity and value
    return availablePlayers
        .map(player => ({
            ...player,
            value: calculateLivePlayerValue(player, positionTrends),
            reason: getRecommendationReason(player, positionTrends)
        }))
        .sort((a, b) => b.value - a.value)
        .slice(0, 10);
}

// Analyze Position Trends from Recent Picks
function analyzePositionTrends(recentPicks) {
    const trends = {};
    
    recentPicks.forEach(pick => {
        const player = players.find(p => p.name === pick.playerName);
        if (player) {
            trends[player.pos] = (trends[player.pos] || 0) + 1;
        }
    });
    
    return trends;
}

// Calculate Live Player Value
function calculateLivePlayerValue(player, trends) {
    let value = player.proj || 0;
    
    // ADP value (lower ADP = higher value)
    value += (300 - (player.adp || 100));
    
    // Position scarcity bonus
    const positionCount = players.filter(p => p.pos === player.pos).length;
    value += (200 / positionCount);
    
    // Trending position bonus
    const trendCount = trends[player.pos] || 0;
    if (trendCount > 1) {
        value += 50; // Position is being targeted, increase urgency
    }
    
    return value;
}

// Get Recommendation Reason
function getRecommendationReason(player, trends) {
    const trendCount = trends[player.pos] || 0;
    
    if (trendCount > 1) return 'Hot Pick';
    if (player.adp && player.adp < player.rank) return 'Value';
    if (player.tier <= 2) return 'Elite';
    return 'BPA';
}

// Test ESPN Connection
async function testESPNConnection() {
    if (!espnLeagueId) {
        showESPNStatus('‚ùå Please enter a League ID first', 'error');
        return;
    }
    
    try {
        showESPNStatus('üîÑ Testing connection...', 'loading');
        const testData = await fetchESPNLeagueData();
        
        if (testData.teams && testData.teams.length > 0) {
            const draftStarted = testData.draftDetail && testData.draftDetail.picks && testData.draftDetail.picks.length > 0;
            showESPNStatus(
                `‚úÖ Success! Found ${testData.teams.length} teams. Draft ${draftStarted ? 'in progress' : 'not started'}.`, 
                'success'
            );
        } else {
            showESPNStatus('‚ö†Ô∏è Connected but no team data found.', 'warning');
        }
    } catch (error) {
        showESPNStatus('‚ùå Connection test failed. Check settings.', 'error');
    }
}

// Show ESPN Status Message
function showESPNStatus(message, type) {
    const statusEl = document.getElementById('espnStatus');
    if (statusEl) {
        statusEl.textContent = message;
        statusEl.className = `text-sm ${
            type === 'success' ? 'text-green-600' : 
            type === 'error' ? 'text-red-600' : 
            type === 'warning' ? 'text-yellow-600' :
            'text-blue-600'
        }`;
    }
}

// Show Notification
function showNotification(message) {
    const notification = document.createElement('div');
    notification.className = 'fixed top-4 right-4 bg-blue-600 text-white p-4 rounded-lg shadow-lg z-50';
    notification.textContent = message;
    document.body.appendChild(notification);
    
    setTimeout(() => notification.remove(), 3000);
}

// Integration Helper Functions
// Call this to integrate with your existing player rendering
window.updateDraftedPlayers = function(draftedNames) {
    // This integrates with your existing system
    // Add drafted players to your global state and re-render
    if (window.renderPlayers) {
        // Update your existing drafted players list
        draftedNames.forEach(name => {
            const player = players.find(p => p.name === name);
            if (player && !myTeam.find(t => t.name === name)) {
                // Optionally auto-add to "my team" if it's your pick
                // This depends on your implementation
            }
        });
        
        window.renderPlayers();
    }
};

// Initialize ESPN Integration
function initESPNIntegration() {
    // Add UI elements
    addESPNIntegrationUI();
    
    // Add ESPN source indicator to existing data status
    const dataStatus = document.querySelector('[data-source="rankings"]')?.parentElement;
    if (dataStatus) {
        const espnIndicator = document.createElement('div');
        espnIndicator.className = 'flex justify-between';
        espnIndicator.innerHTML = `
            <span>ESPN League:</span>
            <span data-source="espn" class="text-gray-600">Not Connected</span>
        `;
        dataStatus.appendChild(espnIndicator);
    }
    
    console.log('ESPN Integration loaded! Open Settings to connect your league.');
}

// Auto-initialize when DOM is ready
if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initESPNIntegration);
} else {
    initESPNIntegration();
}

// Export functions for manual integration
window.ESPN_Integration = {
    connect: connectESPNLeague,
    test: testESPNConnection,
    startLive: startLiveDraft,
    isActive: () => isLiveDraftMode,
    getDraftBoard: () => draftBoard,
    getRecommendations: getSmartDraftRecommendations
};
        // ESPN Enhanced Authentication - Team Integration
// League ID: 1505348419, Team ID: 9

// Enhanced ESPN Configuration
const ESPN_CONFIG = {
    leagueId: '1505348419',
    teamId: 9,
    seasonId: 2025,
    apiBase: 'https://lm-api-reads.fantasy.espn.com/apis/v3/games/ffl/seasons/2025/segments/0/leagues/'
};

// Authentication state
let espnAuth = {
    espn_s2: '',
    swid: '',
    isAuthenticated: false,
    userTeam: null
};

// Enhanced Authentication UI
function addEnhancedESPNAuth() {
    const authSection = `
        <div class="mt-6 p-4 bg-green-50 rounded-lg">
            <h3 class="text-lg font-semibold mb-4">üîê Enhanced ESPN Authentication</h3>
            <div class="space-y-4">
                <div class="bg-blue-100 p-3 rounded">
                    <p class="text-sm"><strong>Your League:</strong> 1505348419</p>
                    <p class="text-sm"><strong>Your Team:</strong> Team 9</p>
                </div>
                
                <div>
                    <label class="block text-sm font-medium mb-2">ESPN_S2 Cookie (Required)</label>
                    <input id="enhancedEspnS2" type="password" class="w-full p-2 border rounded-lg" 
                           placeholder="Paste your ESPN_S2 cookie here">
                </div>
                
                <div>
                    <label class="block text-sm font-medium mb-2">SWID Cookie (Required)</label>
                    <input id="enhancedSwid" type="password" class="w-full p-2 border rounded-lg" 
                           placeholder="Paste your SWID cookie here">
                </div>
                
                <div class="flex space-x-2">
                    <button onclick="authenticateAsTeam9()" class="px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700">
                        üîê Login as Team 9
                    </button>
                    <button onclick="testTeamAuth()" class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">
                        üß™ Test My Access
                    </button>
                    <button onclick="openMockDraft()" class="px-4 py-2 bg-purple-600 text-white rounded hover:bg-purple-700">
                        üéØ Open Mock Draft
                    </button>
                </div>
                
                <div id="enhancedAuthStatus" class="text-sm"></div>
            </div>
            
            <div class="mt-4 p-3 bg-yellow-50 rounded">
                <h4 class="font-medium text-sm mb-2">üç™ How to Get Your Cookies:</h4>
                <ol class="text-xs text-gray-600 space-y-1">
                    <li>1. Open ESPN Fantasy in new tab</li>
                    <li>2. Login to your account</li>
                    <li>3. Press F12 ‚Üí Application tab ‚Üí Cookies ‚Üí espn.com</li>
                    <li>4. Find "espn_s2" and copy its Value</li>
                    <li>5. Find "SWID" and copy its Value</li>
                    <li>6. Paste both here and click "Login as Team 9"</li>
                </ol>
            </div>
        </div>
    `;
    
    // Add to settings panel
    const settings = document.getElementById('settings');
    if (settings) {
        settings.insertAdjacentHTML('beforeend', authSection);
    }
}

// Authenticate as Team 9
async function authenticateAsTeam9() {
    const espnS2 = document.getElementById('enhancedEspnS2').value.trim();
    const swid = document.getElementById('enhancedSwid').value.trim();
    
    if (!espnS2 || !swid) {
        showEnhancedStatus('‚ùå Please enter both ESPN_S2 and SWID cookies', 'error');
        return;
    }
    
    espnAuth.espn_s2 = espnS2;
    espnAuth.swid = swid;
    
    try {
        showEnhancedStatus('üîÑ Authenticating as Team 9...', 'loading');
        
        // Test authentication by fetching team data
        const teamData = await fetchMyTeamData();
        
        if (teamData) {
            espnAuth.isAuthenticated = true;
            espnAuth.userTeam = teamData;
            
            // Save auth to localStorage for persistence
            localStorage.setItem('espn_team_auth', JSON.stringify({
                espn_s2: espnS2,
                swid: swid,
                leagueId: ESPN_CONFIG.leagueId,
                teamId: ESPN_CONFIG.teamId,
                authenticated: true,
                timestamp: Date.now()
            }));
            
            showEnhancedStatus(`‚úÖ Successfully logged in as ${teamData.location} ${teamData.nickname}!`, 'success');
            enableTeamFeatures();
        } else {
            throw new Error('Failed to fetch team data');
        }
        
    } catch (error) {
        console.error('Authentication failed:', error);
        showEnhancedStatus('‚ùå Authentication failed. Check your cookies and try again.', 'error');
    }
}

// Fetch My Team Data - CORS FIXED VERSION
async function fetchMyTeamData() {
    const url = `${ESPN_CONFIG.apiBase}${ESPN_CONFIG.leagueId}?view=mTeam&view=mRoster`;
    
    // Use CORS proxy to bypass browser restrictions
    const proxyUrl = 'https://api.allorigins.win/get?url=' + encodeURIComponent(url);
    
    const response = await fetch(proxyUrl, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({
            url: url,
            headers: {
                'Cookie': `espn_s2=${espnAuth.espn_s2}; SWID=${espnAuth.swid}`,
                'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36'
            }
        })
    });
    
    if (!response.ok) throw new Error('Failed to fetch team data');
    
    const proxyData = await response.json();
    const data = JSON.parse(proxyData.contents);
    return data.teams ? data.teams.find(team => team.id === ESPN_CONFIG.teamId) : null;
}

// Test Team Authentication
async function testTeamAuth() {
    if (!espnAuth.isAuthenticated) {
        showEnhancedStatus('‚ùå Please authenticate first', 'error');
        return;
    }
    
    try {
        showEnhancedStatus('üß™ Testing your team access...', 'loading');
        
        // Test various endpoints
        const [teamData, rosterData, draftData] = await Promise.all([
            fetchMyTeamData(),
            fetchMyRoster(),
            fetchDraftStatus()
        ]);
        
        const results = {
            team: teamData ? '‚úÖ' : '‚ùå',
            roster: rosterData ? '‚úÖ' : '‚ùå',
            draft: draftData ? '‚úÖ' : '‚ùå'
        };
        
        showEnhancedStatus(
            `Test Results: Team ${results.team} Roster ${results.roster} Draft ${results.draft}`, 
            'success'
        );
        
    } catch (error) {
        showEnhancedStatus('‚ùå Test failed. Your cookies may have expired.', 'error');
    }
}

// Fetch My Roster - CORS FIXED VERSION
async function fetchMyRoster() {
    const url = `${ESPN_CONFIG.apiBase}${ESPN_CONFIG.leagueId}?view=mRoster&view=mTeam`;
    const proxyUrl = 'https://api.allorigins.win/get?url=' + encodeURIComponent(url);
    
    const response = await fetch(proxyUrl);
    if (!response.ok) throw new Error('Failed to fetch roster');
    
    const proxyData = await response.json();
    const data = JSON.parse(proxyData.contents);
    const myTeam = data.teams?.find(team => team.id === ESPN_CONFIG.teamId);
    return myTeam?.roster || null;
}

// Fetch Draft Status - CORS FIXED VERSION
async function fetchDraftStatus() {
    const url = `${ESPN_CONFIG.apiBase}${ESPN_CONFIG.leagueId}?view=mDraftDetail`;
    const proxyUrl = 'https://api.allorigins.win/get?url=' + encodeURIComponent(url);
    
    const response = await fetch(proxyUrl);
    if (!response.ok) throw new Error('Failed to fetch draft status');
    
    const proxyData = await response.json();
    const data = JSON.parse(proxyData.contents);
    return data.draftDetail || null;
}

// Open Mock Draft in ESPN
function openMockDraft() {
    const mockDraftUrl = `https://fantasy.espn.com/football/draft?leagueId=${ESPN_CONFIG.leagueId}`;
    window.open(mockDraftUrl, '_blank');
    showEnhancedStatus('üéØ Mock draft opened! Use both windows together.', 'success');
}

// Enable Team-Specific Features
function enableTeamFeatures() {
    // Add team-specific UI elements
    addMyTeamPanel();
    
    // Enable draft integration
    enableDraftIntegration();
    
    // Start monitoring my picks
    startTeamMonitoring();
}

// Add My Team Panel
function addMyTeamPanel() {
    const sidebar = document.querySelector('.space-y-6');
    if (!sidebar) return;
    
    const teamPanel = `
        <div id="myTeamPanel" class="bg-white rounded-lg shadow p-6">
            <h3 class="text-lg font-semibold mb-4">üë§ My ESPN Team</h3>
            <div id="myTeamInfo" class="space-y-2 text-sm">
                <div class="flex justify-between">
                    <span>Team:</span>
                    <span id="teamName" class="font-medium">Team 9</span>
                </div>
                <div class="flex justify-between">
                    <span>Status:</span>
                    <span id="authStatus" class="font-medium text-green-600">Authenticated</span>
                </div>
            </div>
            
            <div class="mt-4 space-y-2">
                <button onclick="syncESPNRoster()" class="w-full p-2 bg-blue-600 text-white rounded hover:bg-blue-700 text-sm">
                    üîÑ Sync ESPN Roster
                </button>
                <button onclick="openMyTeam()" class="w-full p-2 bg-green-600 text-white rounded hover:bg-green-700 text-sm">
                    üë• View My Team on ESPN
                </button>
            </div>
        </div>
    `;
    
    sidebar.insertAdjacentHTML('afterbegin', teamPanel);
}

// Sync ESPN Roster with Local Data
async function syncESPNRoster() {
    if (!espnAuth.isAuthenticated) return;
    
    try {
        const roster = await fetchMyRoster();
        if (roster && roster.entries) {
            // Clear current team and sync with ESPN
            myTeam = [];
            
            roster.entries.forEach(entry => {
                const player = entry.playerPoolEntry?.player;
                if (player) {
                    const localPlayer = players.find(p => 
                        p.name.includes(player.fullName) || 
                        player.fullName.includes(p.name)
                    );
                    
                    if (localPlayer) {
                        myTeam.push(localPlayer);
                    }
                }
            });
            
            // Update UI
            if (window.updateMyTeam) {
                window.updateMyTeam();
            }
            
            showEnhancedStatus(`‚úÖ Synced ${myTeam.length} players from ESPN`, 'success');
        }
    } catch (error) {
        showEnhancedStatus('‚ùå Sync failed', 'error');
    }
}

// Open My Team on ESPN
function openMyTeam() {
    const teamUrl = `https://fantasy.espn.com/football/team?leagueId=${ESPN_CONFIG.leagueId}&teamId=${ESPN_CONFIG.teamId}`;
    window.open(teamUrl, '_blank');
}

// Start Team Monitoring
function startTeamMonitoring() {
    // Monitor for draft updates specific to your team
    setInterval(async () => {
        if (espnAuth.isAuthenticated) {
            try {
                await checkForMyPicks();
            } catch (error) {
                console.warn('Team monitoring error:', error);
            }
        }
    }, 5000); // Check every 5 seconds during draft
}

// Check for My Picks
async function checkForMyPicks() {
    const draftStatus = await fetchDraftStatus();
    if (!draftStatus || !draftStatus.picks) return;
    
    const myPicks = draftStatus.picks.filter(pick => pick.teamId === ESPN_CONFIG.teamId);
    
    // Update local team with my actual picks
    myPicks.forEach(pick => {
        const playerName = getPlayerNameById(pick.playerId);
        if (playerName) {
            const player = players.find(p => p.name === playerName);
            if (player && !myTeam.find(t => t.name === playerName)) {
                myTeam.push(player);
                showNotification(`‚úÖ Confirmed pick: ${playerName}`);
            }
        }
    });
}

// Enhanced Status Display
function showEnhancedStatus(message, type) {
    const statusEl = document.getElementById('enhancedAuthStatus');
    if (statusEl) {
        statusEl.textContent = message;
        statusEl.className = `text-sm ${
            type === 'success' ? 'text-green-600' : 
            type === 'error' ? 'text-red-600' : 
            'text-blue-600'
        }`;
    }
}

// Auto-load saved authentication
function loadSavedAuth() {
    const saved = localStorage.getItem('espn_team_auth');
    if (saved) {
        const auth = JSON.parse(saved);
        
        // Check if auth is less than 24 hours old
        if (Date.now() - auth.timestamp < 24 * 60 * 60 * 1000) {
            document.getElementById('enhancedEspnS2').value = auth.espn_s2;
            document.getElementById('enhancedSwid').value = auth.swid;
            showEnhancedStatus('üîÑ Saved authentication found. Click "Login as Team 9" to restore.', 'info');
        }
    }
}

// Initialize Enhanced Authentication
function initEnhancedAuth() {
    addEnhancedESPNAuth();
    
    // Load saved auth after UI is added
    setTimeout(loadSavedAuth, 100);
    
    console.log('Enhanced ESPN Authentication loaded for Team 9!');
}

// Auto-initialize
if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initEnhancedAuth);
} else {
    initEnhancedAuth();
}

// Export for manual access
window.ESPN_Team = {
    authenticate: authenticateAsTeam9,
    test: testTeamAuth,
    sync: syncESPNRoster,
    isAuthenticated: () => espnAuth.isAuthenticated,
    getTeamData: () => espnAuth.userTeam
};
        // Manual ESPN Integration - Add this to your existing script section
function addManualESPNSync() {
    const manualSection = `
        <div class="mt-6 p-4 bg-green-50 rounded-lg">
            <h3 class="text-lg font-semibold mb-4">üèà ESPN Manual Sync (Works 100%)</h3>
            <p class="text-sm mb-4 text-gray-700">Chrome blocks ESPN cookies, so we'll sync manually:</p>
            
            <div class="space-y-3">
                <button onclick="openESPNMock()" class="w-full p-3 bg-blue-600 text-white rounded hover:bg-blue-700 font-medium">
                    üéØ Open ESPN Mock Draft (New Window)
                </button>
                
                <div class="bg-white p-3 rounded border">
                    <label class="block text-sm font-medium mb-2">When you draft a player on ESPN, add them here:</label>
                    <div class="flex space-x-2">
                        <input id="draftedPlayer" type="text" placeholder="Enter player name" class="flex-1 p-2 border rounded">
                        <button onclick="addDraftedPlayer()" class="px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700">
                            Add to My Team
                        </button>
                    </div>
                </div>
                
                <div class="bg-yellow-50 p-3 rounded">
                    <h4 class="font-medium text-sm mb-2">üìù Draft Workflow:</h4>
                    <ol class="text-xs space-y-1">
                        <li>1. Click "Open ESPN Mock Draft" above</li>
                        <li>2. Use THIS tool to see recommendations</li>
                        <li>3. Make pick on ESPN window</li>
                        <li>4. Type player name above and click "Add to My Team"</li>
                        <li>5. Repeat for each pick</li>
                    </ol>
                </div>
            </div>
        </div>
    `;
    
    // Add to settings panel
    const settings = document.getElementById('settings');
    if (settings) {
        settings.insertAdjacentHTML('beforeend', manualSection);
    }
}

// Open ESPN Mock Draft
function openESPNMock() {
    const espnUrl = 'https://fantasy.espn.com/football/draft?leagueId=1505348419';
    window.open(espnUrl, '_blank', 'width=1200,height=800');
    alert('ESPN opened! Use both windows side by side for drafting.');
}

// Add drafted player manually
function addDraftedPlayer() {
    const playerName = document.getElementById('draftedPlayer').value.trim();
    if (!playerName) return;
    
    // Find player in our database
    const player = players.find(p => 
        p.name.toLowerCase().includes(playerName.toLowerCase()) ||
        playerName.toLowerCase().includes(p.name.toLowerCase())
    );
    
    if (player) {
        // Check if already on team
        if (!myTeam.find(t => t.name === player.name)) {
            myTeam.push(player);
            updateMyTeam(); // Your existing function
            document.getElementById('draftedPlayer').value = '';
            
            // Show success
            const notification = document.createElement('div');
            notification.className = 'fixed top-4 right-4 bg-green-600 text-white p-3 rounded shadow-lg z-50';
            notification.textContent = `‚úÖ Added ${player.name} to your team!`;
            document.body.appendChild(notification);
            setTimeout(() => notification.remove(), 3000);
            
            // Re-render players list
            if (window.renderPlayers) renderPlayers();
        } else {
            alert('Player already on your team!');
        }
    } else {
        alert(`Player "${playerName}" not found. Try typing just the last name.`);
    }
}

// Initialize manual sync
document.addEventListener('DOMContentLoaded', function() {
    setTimeout(addManualESPNSync, 1000); // Add after page loads
});
    </script>
</body>
</html>
