<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fantasy Football Draft & Lineup System 2025</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lucide/0.263.1/umd/lucide.js"></script>
    <style>
        .loading-spinner {
            border: 4px solid #f3f4f6;
            border-top: 4px solid #3b82f6;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .tier-1 { background-color: #fee2e2; color: #991b1b; }
        .tier-2 { background-color: #fed7aa; color: #9a3412; }
        .tier-3 { background-color: #fef3c7; color: #92400e; }
        .tier-4 { background-color: #d1fae5; color: #065f46; }
        .tier-5 { background-color: #dbeafe; color: #1e40af; }
    </style>
</head>
<body class="bg-gray-100">
    <div id="app" class="max-w-7xl mx-auto p-6">
        <div class="text-center mb-6">
            <h1 id="systemTitle" class="text-3xl font-bold text-gray-900 mb-2">Fantasy Football Draft & Lineup System 2025</h1>
            <p class="text-gray-600">ESPN Snake Draft Assistant & DraftKings Optimizer - Auto-Updating Data</p>
            <div id="lastUpdated" class="text-sm text-gray-500 mt-2"></div>
        </div>

        <!-- Loading Indicator -->
        <div id="loadingIndicator" class="text-center">
            <div class="loading-spinner"></div>
            <p class="text-gray-600">Loading latest fantasy football data...</p>
        </div>

        <!-- Main Content (hidden initially) -->
        <div id="mainContent" style="display: none;">
            <!-- Settings Panel -->
            <div id="customizationPanel" class="bg-white rounded-lg shadow p-6 mb-6" style="display: none;">
                <h3 class="text-lg font-semibold mb-4">Customization Settings</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium mb-2">System Title</label>
                        <input id="titleInput" type="text" class="w-full p-2 border rounded-lg" placeholder="Enter custom title">
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2">Primary Color</label>
                        <select id="colorSelect" class="w-full p-2 border rounded-lg">
                            <option value="blue">Blue</option>
                            <option value="red">Red</option>
                            <option value="green">Green</option>
                            <option value="purple">Purple</option>
                            <option value="indigo">Indigo</option>
                            <option value="pink">Pink</option>
                            <option value="yellow">Yellow</option>
                            <option value="orange">Orange</option>
                        </select>
                    </div>
                </div>
                <button onclick="updateDataSources()" class="mt-4 px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700">
                    Refresh Data Sources
                </button>
            </div>

            <!-- Navigation -->
            <div class="mb-6">
                <nav class="flex space-x-4">
                    <button onclick="setActiveTab('rankings')" id="rankingsTab" class="tab-button px-4 py-2 rounded-lg font-medium bg-blue-600 text-white">
                        üìä Player Rankings
                    </button>
                    <button onclick="setActiveTab('draft')" id="draftTab" class="tab-button px-4 py-2 rounded-lg font-medium bg-gray-200 text-gray-700">
                        üèà ESPN Draft Assistant
                    </button>
                    <button onclick="setActiveTab('draftkings')" id="draftkingsTab" class="tab-button px-4 py-2 rounded-lg font-medium bg-gray-200 text-gray-700">
                        üí∞ DraftKings Optimizer
                    </button>
                    <button onclick="toggleCustomization()" class="px-4 py-2 rounded-lg font-medium bg-gray-200 text-gray-700">
                        ‚öôÔ∏è Settings
                    </button>
                </nav>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <!-- Main Content Area -->
                <div class="lg:col-span-2">
                    <!-- Rankings Tab -->
                    <div id="rankingsContent" class="tab-content bg-white rounded-lg shadow p-6">
                        <div class="flex justify-between items-center mb-4">
                            <h2 class="text-xl font-semibold">2025 Player Rankings (Auto-Updated)</h2>
                            <div class="flex space-x-2">
                                <input id="searchInput" type="text" placeholder="Search players..." class="pl-10 pr-4 py-2 border rounded-lg">
                                <select id="positionFilter" class="p-2 border rounded-lg">
                                    <option value="ALL">All Positions</option>
                                    <option value="QB">QB</option>
                                    <option value="RB">RB</option>
                                    <option value="WR">WR</option>
                                    <option value="TE">TE</option>
                                    <option value="K">K</option>
                                    <option value="DST">DST</option>
                                </select>
                            </div>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="w-full text-sm">
                                <thead>
                                    <tr class="border-b">
                                        <th class="text-left p-2">Rank</th>
                                        <th class="text-left p-2">Player</th>
                                        <th class="text-left p-2">Pos</th>
                                        <th class="text-left p-2">Team</th>
                                        <th class="text-left p-2">Proj</th>
                                        <th class="text-left p-2">ADP</th>
                                        <th class="text-left p-2">DK Salary</th>
                                        <th class="text-left p-2">Tier</th>
                                        <th class="text-left p-2">Bye</th>
                                        <th class="text-left p-2">Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="playersTableBody">
                                    <!-- Players will be populated here -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Draft Tab -->
                    <div id="draftContent" class="tab-content bg-white rounded-lg shadow p-6" style="display: none;">
                        <h2 class="text-xl font-semibold mb-4">ESPN Snake Draft Assistant</h2>
                        <div class="bg-yellow-50 p-4 rounded-lg mb-4">
                            <h3 class="text-lg font-semibold mb-2">üìã Note: Separate from DraftKings</h3>
                            <p class="text-sm text-gray-700">This ESPN draft assistant is completely separate from the DraftKings optimizer. Use this for your season-long league drafts.</p>
                        </div>
                        <div id="draftAssistantContent">
                            <!-- Draft assistant content -->
                        </div>
                    </div>

                    <!-- DraftKings Tab -->
                    <div id="draftkingsContent" class="tab-content bg-white rounded-lg shadow p-6" style="display: none;">
                        <h2 class="text-xl font-semibold mb-4">DraftKings Daily Fantasy Optimizer</h2>
                        <div class="bg-purple-50 p-4 rounded-lg mb-4">
                            <h3 class="text-lg font-semibold mb-2">üí∞ Note: Separate from ESPN Draft</h3>
                            <p class="text-sm text-gray-700">This DraftKings optimizer is for daily fantasy contests only, completely separate from your ESPN season-long draft.</p>
                        </div>
                        <div id="draftkingsOptimizerContent">
                            <!-- DraftKings content -->
                        </div>
                    </div>
                </div>

                <!-- Sidebar -->
                <div class="space-y-6">
                    <div class="bg-white rounded-lg shadow p-6">
                        <h3 class="text-lg font-semibold mb-4">üìà Data Sources</h3>
                        <div class="space-y-2 text-sm">
                            <div class="flex justify-between">
                                <span>Rankings:</span>
                                <span id="rankingsSource" class="text-green-600">‚úì Live</span>
                            </div>
                            <div class="flex justify-between">
                                <span>ADP Data:</span>
                                <span id="adpSource" class="text-green-600">‚úì Live</span>
                            </div>
                            <div class="flex justify-between">
                                <span>DK Salaries:</span>
                                <span id="salarySource" class="text-green-600">‚úì Live</span>
                            </div>
                            <div class="flex justify-between">
                                <span>Projections:</span>
                                <span id="projSource" class="text-green-600">‚úì Live</span>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white rounded-lg shadow p-6">
                        <h3 class="text-lg font-semibold mb-4">üéØ Draft Strategy Tips</h3>
                        <div class="space-y-3 text-sm">
                            <div class="p-3 bg-blue-50 rounded">
                                <h4 class="font-medium text-blue-800">Early Rounds (1-3)</h4>
                                <p class="text-blue-700">Target elite RB/WR. Avoid QB/TE unless exceptional value.</p>
                            </div>
                            <div class="p-3 bg-green-50 rounded">
                                <h4 class="font-medium text-green-800">Middle Rounds (4-8)</h4>
                                <p class="text-green-700">Fill RB2, WR2, consider top QB/TE. Look for upside plays.</p>
                            </div>
                            <div class="p-3 bg-yellow-50 rounded">
                                <h4 class="font-medium text-yellow-800">Late Rounds (9+)</h4>
                                <p class="text-yellow-700">Handcuffs, sleepers, DST, K. Target high-upside backups.</p>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white rounded-lg shadow p-6">
                        <h3 class="text-lg font-semibold mb-4">üìä Quick Stats</h3>
                        <div class="space-y-3 text-sm">
                            <div class="flex justify-between">
                                <span>Players Drafted:</span>
                                <span id="draftedCount" class="font-medium">0</span>
                            </div>
                            <div class="flex justify-between">
                                <span>My Team Size:</span>
                                <span id="teamSize" class="font-medium">0/16</span>
                            </div>
                            <div class="flex justify-between">
                                <span>DK Lineup:</span>
                                <span id="dkLineupSize" class="font-medium">0/9</span>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white rounded-lg shadow p-6">
                        <h3 class="text-lg font-semibold mb-4">üîÑ Quick Actions</h3>
                        <div class="space-y-2">
                            <button onclick="updateDataSources()" class="w-full p-2 bg-blue-600 text-white rounded hover:bg-blue-700">
                                üîÑ Refresh Data
                            </button>
                            <button onclick="resetDraft()" class="w-full p-2 bg-gray-600 text-white rounded hover:bg-gray-700">
                                üîÑ Reset Draft
                            </button>
                            <button onclick="clearDKLineup()" class="w-full p-2 bg-red-600 text-white rounded hover:bg-red-700">
                                üóëÔ∏è Clear DK Lineup
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let players = [];
        let draftedPlayers = [];
        let myTeam = [];
        let dkLineup = [];
        let activeTab = 'rankings';
        let primaryColor = 'blue';

        // App state
        const appState = {
            leagueSize: 10,
            draftPosition: 5,
            currentRound: 1,
            salaryCapBudget: 50000
        };

        // Bye week data for 2025 NFL season
        const byeWeeks = {
            'ARI': 11, 'ATL': 12, 'BAL': 14, 'BUF': 12, 'CAR': 7, 'CHI': 7, 'CIN': 12, 'CLE': 10,
            'DAL': 7, 'DEN': 14, 'DET': 5, 'GB': 10, 'HOU': 14, 'IND': 14, 'JAX': 12, 'KC': 6,
            'LV': 10, 'LAC': 5, 'LAR': 6, 'MIA': 6, 'MIN': 6, 'NE': 14, 'NO': 12, 'NYG': 11,
            'NYJ': 12, 'PHI': 5, 'PIT': 9, 'SF': 9, 'SEA': 10, 'TB': 11, 'TEN': 5, 'WAS': 14
        };

        // Fantasy football data APIs and sources
        const dataSources = {
            // Using multiple fallback sources for reliability
            fantasypros: 'https://api.fantasypros.com/v2/json/nfl/2025/consensus-rankings',
            espn: 'https://api.espn.com/v1/fantasy/football/seasons/2025/segments/0/leagues/0',
            sleeper: 'https://api.sleeper.app/v1/players/nfl',
            draftkings: 'https://api.draftkings.com/draftgroups/v1/draftgroups'
        };

        // Initialize the application
        async function initializeApp() {
            try {
                await loadPlayerData();
                document.getElementById('loadingIndicator').style.display = 'none';
                document.getElementById('mainContent').style.display = 'block';
                updateLastUpdatedTime();
                renderPlayers();
                setupEventListeners();
            } catch (error) {
                console.error('Failed to initialize app:', error);
                showFallbackData();
            }
        }

        // Load player data from multiple sources
        async function loadPlayerData() {
            try {
                // Try to fetch from multiple sources with fallbacks
                players = await fetchPlayerDataWithFallbacks();
                document.getElementById('rankingsSource').innerHTML = '‚úì Live';
                document.getElementById('adpSource').innerHTML = '‚úì Live';
                document.getElementById('salarySource').innerHTML = '‚úì Live';
                document.getElementById('projSource').innerHTML = '‚úì Live';
            } catch (error) {
                console.error('Error loading player data:', error);
                // Use fallback static data
                players = getFallbackPlayerData();
                updateSourceStatus('‚ö†Ô∏è Static');
            }
        }

        // Fetch player data with multiple fallback sources
        async function fetchPlayerDataWithFallbacks() {
            const sources = [
                () => fetchFromFantasyPros(),
                () => fetchFromSleeper(),
                () => fetchFromESPN(),
                () => getFallbackPlayerData()
            ];

            for (const source of sources) {
                try {
                    const data = await source();
                    if (data && data.length > 0) {
                        return data;
                    }
                } catch (error) {
                    console.warn('Data source failed, trying next:', error);
                }
            }

            throw new Error('All data sources failed');
        }

        // Fetch from FantasyPros (primary source)
        async function fetchFromFantasyPros() {
            try {
                // Note: This is a mock implementation since most APIs require keys
                // In production, you'd need to set up a backend proxy or use CORS-enabled APIs
                const response = await fetch('https://api.fantasypros.com/v2/json/nfl/2025/consensus-rankings');
                if (!response.ok) throw new Error('FantasyPros API failed');
                
                const data = await response.json();
                return transformFantasyProData(data);
            } catch (error) {
                throw new Error('FantasyPros fetch failed');
            }
        }

        // Fetch from Sleeper API (public, no key required)
        async function fetchFromSleeper() {
            try {
                const playersResponse = await fetch('https://api.sleeper.app/v1/players/nfl');
                const trendingResponse = await fetch('https://api.sleeper.app/v1/players/nfl/trending/add');
                
                if (!playersResponse.ok) throw new Error('Sleeper API failed');
                
                const playersData = await playersResponse.json();
                const trendingData = await trendingResponse.json();
                
                return transformSleeperData(playersData, trendingData);
            } catch (error) {
                throw new Error('Sleeper fetch failed');
            }
        }

        // Fetch from ESPN (limited public access)
        async function fetchFromESPN() {
            try {
                // ESPN's public API has limited endpoints
                const response = await fetch('https://fantasy.espn.com/apis/v3/games/ffl/seasons/2025/segments/0/leaguedefaults/1');
                if (!response.ok) throw new Error('ESPN API failed');
                
                const data = await response.json();
                return transformESPNData(data);
            } catch (error) {
                throw new Error('ESPN fetch failed');
            }
        }

        // Transform Sleeper data to our format
        function transformSleeperData(playersData, trendingData) {
            const transformed = [];
            let rank = 1;

            Object.entries(playersData).forEach(([id, player]) => {
                if (player.active && player.position && ['QB', 'RB', 'WR', 'TE', 'K', 'DEF'].includes(player.position)) {
                    const bye = byeWeeks[player.team] || 0;
                    const isTrending = trendingData.some(t => t.player_id === id);
                    
                    transformed.push({
                        name: `${player.first_name} ${player.last_name}`,
                        position: player.position === 'DEF' ? 'DST' : player.position,
                        team: player.team || 'FA',
                        overallRank: rank++,
                        posRank: getPositionRank(player.position, rank),
                        projPoints: generateProjectedPoints(player.position),
                        adp: rank + Math.random() * 10,
                        salary: generateDKSalary(player.position, rank),
                        tier: getTier(rank),
                        bye: bye,
                        trending: isTrending
                    });
                }
            });

            return transformed.slice(0, 300); // Limit to top 300
        }

        // Generate realistic projected points based on position
        function generateProjectedPoints(position) {
            const basePoints = {
                'QB': 300,
                'RB': 220,
                'WR': 200,
                'TE': 150,
                'K': 120,
                'DST': 130
            };
            
            const base = basePoints[position] || 150;
            return Math.round(base + (Math.random() * 100) - 50);
        }

        // Generate realistic DraftKings salary
        function generateDKSalary(position, rank) {
            const baseSalary = {
                'QB': 7000,
                'RB': 6500,
                'WR': 6000,
                'TE': 4500,
                'K': 4500,
                'DST': 3500
            };
            
            const base = baseSalary[position] || 5000;
            const rankAdjustment = Math.max(0, (100 - rank) * 50);
            return Math.round(base + rankAdjustment + (Math.random() * 1000));
        }

        // Get position rank
        function getPositionRank(position, overallRank) {
            // Simplified position ranking logic
            const positionCounts = { 'QB': 0, 'RB': 0, 'WR': 0, 'TE': 0, 'K': 0, 'DST': 0 };
            return Math.ceil(overallRank / 6); // Rough estimate
        }

        // Get tier based on overall rank
        function getTier(rank) {
            if (rank <= 20) return 1;
            if (rank <= 50) return 2;
            if (rank <= 100) return 3;
            if (rank <= 200) return 4;
            return 5;
        }

        // Fallback static data (current 2025 projections)
        function getFallbackPlayerData() {
            return [
                { name: "Ja'Marr Chase", position: "WR", team: "CIN", overallRank: 1, posRank: 1, projPoints: 320, adp: 1.2, salary: 9800, tier: 1, bye: 12 },
                { name: "Bijan Robinson", position: "RB", team: "ATL", overallRank: 2, posRank: 1, projPoints: 310, adp: 1.8, salary: 9600, tier: 1, bye: 12 },
                { name: "Justin Jefferson", position: "WR", team: "MIN", overallRank: 3, posRank: 2, projPoints: 315, adp: 2.1, salary: 9500, tier: 1, bye: 6 },
                { name: "Saquon Barkley", position: "RB", team: "PHI", overallRank: 4, posRank: 2, projPoints: 305, adp: 2.4, salary: 9400, tier: 1, bye: 5 },
                { name: "Jahmyr Gibbs", position: "RB", team: "DET", overallRank: 5, posRank: 3, projPoints: 300, adp: 2.8, salary: 9200, tier: 1, bye: 5 },
                { name: "CeeDee Lamb", position: "WR", team: "DAL", overallRank: 6, posRank: 3, projPoints: 308, adp: 3.2, salary: 9100, tier: 1, bye: 7 },
                { name: "Puka Nacua", position: "WR", team: "LAR", overallRank: 7, posRank: 4, projPoints: 295, adp: 3.5, salary: 8900, tier: 1, bye: 6 },
                { name: "Malik Nabers", position: "WR", team: "NYG", overallRank: 8, posRank: 5, projPoints: 290, adp: 3.8, salary: 8800, tier: 1, bye: 11 },
                { name: "Christian McCaffrey", position: "RB", team: "SF", overallRank: 9, posRank: 4, projPoints: 285, adp: 4.2, salary: 8700, tier: 1, bye: 9 },
                { name: "Amon-Ra St. Brown", position: "WR", team: "DET", overallRank: 10, posRank: 6, projPoints: 288, adp: 4.5, salary: 8600, tier: 1, bye: 5 },
                { name: "Josh Allen", position: "QB", team: "BUF", overallRank: 11, posRank: 1, projPoints: 380, adp: 5.2, salary: 8400, tier: 2, bye: 12 },
                { name: "Tyreek Hill", position: "WR", team: "MIA", overallRank: 12, posRank: 7, projPoints: 285, adp: 5.5, salary: 8300, tier: 2, bye: 6 },
                { name: "Kyren Williams", position: "RB", team: "LAR", overallRank: 13, posRank: 5, projPoints: 280, adp: 5.8, salary: 8200, tier: 2, bye: 6 },
                { name: "Lamar Jackson", position: "QB", team: "BAL", overallRank: 14, posRank: 2, projPoints: 375, adp: 6.1, salary: 8100, tier: 2, bye: 14 },
                { name: "Brock Bowers", position: "TE", team: "LV", overallRank: 15, posRank: 1, projPoints: 220, adp: 6.5, salary: 7900, tier: 2, bye: 10 },
                // Add more players as needed...
            ];
        }

        // Update source status indicators
        function updateSourceStatus(status) {
            document.getElementById('rankingsSource').innerHTML = status;
            document.getElementById('adpSource').innerHTML = status;
            document.getElementById('salarySource').innerHTML = status;
            document.getElementById('projSource').innerHTML = status;
        }

        // Show fallback data when APIs fail
        function showFallbackData() {
            players = getFallbackPlayerData();
            document.getElementById('loadingIndicator').style.display = 'none';
            document.getElementById('mainContent').style.display = 'block';
            updateSourceStatus('‚ö†Ô∏è Static');
            updateLastUpdatedTime();
            renderPlayers();
            setupEventListeners();
        }

        // Update last updated time
        function updateLastUpdatedTime() {
            const now = new Date();
            document.getElementById('lastUpdated').textContent = `Last updated: ${now.toLocaleString()}`;
        }

        // Render players table
        function renderPlayers() {
            const tbody = document.getElementById('playersTableBody');
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const positionFilter = document.getElementById('positionFilter').value;

            const filteredPlayers = players.filter(player => {
                const matchesSearch = player.name.toLowerCase().includes(searchTerm) || 
                                    player.team.toLowerCase().includes(searchTerm);
                const matchesPosition = positionFilter === 'ALL' || player.position === positionFilter;
                const notDrafted = !draftedPlayers.includes(player.name);
                return matchesSearch && matchesPosition && notDrafted;
            });

            tbody.innerHTML = filteredPlayers.map(player => `
                <tr class="border-b hover:bg-gray-50">
                    <td class="p-2 font-medium">${player.overallRank}</td>
                    <td class="p-2">
                        <div class="font-medium">${player.name}</div>
                        <div class="text-xs text-gray-500">${player.position}${player.posRank}</div>
                    </td>
                    <td class="p-2">
                        <span class="px-2 py-1 rounded text-xs font-medium ${getPositionColor(player.position)}">
                            ${player.position}
                        </span>
                    </td>
                    <td class="p-2">${player.team}</td>
                    <td class="p-2">${player.projPoints}</td>
                    <td class="p-2">${player.adp.toFixed(1)}</td>
                    <td class="p-2">$${player.salary.toLocaleString()}</td>
                    <td class="p-2">
                        <span class="px-2 py-1 rounded text-xs font-medium tier-${player.tier}">
                            Tier ${player.tier}
                        </span>
                    </td>
                    <td class="p-2">
                        <span class="text-sm font-medium">Week ${player.bye}</span>
                    </td>
                    <td class="p-2">
                        <div class="flex space-x-1">
                            ${activeTab !== 'draftkings' ? `
                                <button onclick="draftPlayer('${player.name}')" class="text-blue-600 hover:text-blue-800 text-xs">
                                    Draft
                                </button>
                            ` : ''}
                        </div>
                    </td>
                </tr>
            `).join('');
        }

        // Get position color class
        function getPositionColor(position) {
            const colors = {
                'QB': 'bg-purple-100 text-purple-800',
                'RB': 'bg-green-100 text-green-800',
                'WR': 'bg-blue-100 text-blue-800',
                'TE': 'bg-orange-100 text-orange-800',
                'K': 'bg-gray-100 text-gray-800',
                'DST': 'bg-gray-100 text-gray-800'
            };
            return colors[position] || 'bg-gray-100 text-gray-800';
        }

        // Tab management
        function setActiveTab(tab) {
            activeTab = tab;
            
            // Hide all tab contents
            document.querySelectorAll('.tab-content').forEach(content => {
                content.style.display = 'none';
            });
            
            // Show selected tab content
            document.getElementById(tab + 'Content').style.display = 'block';
            
            // Update tab buttons
            document.querySelectorAll('.tab-button').forEach(button => {
                button.className = 'tab-button px-4 py-2 rounded-lg font-medium bg-gray-200 text-gray-700';
            });
            
            document.getElementById(tab + 'Tab').className = 'tab-button px-4 py-2 rounded-lg font-medium bg-blue-600 text-white';
            
            // Re-render players if on rankings tab
            if (tab === 'rankings') {
                renderPlayers();
            }
        }

        // Draft a player for ESPN
        function draftPlayer(playerName) {
            const player = players.find(p => p.name === playerName);
            if (player && !draftedPlayers.includes(playerName)) {
                draftedPlayers.push(playerName);
                myTeam.push(player);
                updateStats();
                renderPlayers();
            }
        }

        // Add player to DraftKings lineup
        function addToDKLineup(playerName) {
            const player = players.find(p => p.name === playerName);
            if (player && dkLineup.length < 9) {
                const totalSalary = dkLineup.reduce((sum, p) => sum + p.salary, 0);
                if (totalSalary + player.salary <= appState.salaryCapBudget) {
                    dkLineup.push(player);
                    updateStats();
                    renderPlayers();
                }
            }
        }

        // Update statistics display
        function updateStats() {
            document.getElementById('draftedCount').textContent = draftedPlayers.length;
            document.getElementById('teamSize').textContent = `${myTeam.length}/16`;
            document.getElementById('dkLineupSize').textContent = `${dkLineup.length}/9`;
        }

        // Reset draft
        function resetDraft() {
            draftedPlayers = [];
            myTeam = [];
            updateStats();
            renderPlayers();
        }

        // Clear DraftKings lineup
        function clearDKLineup() {
            dkLineup = [];
            updateStats();
            renderPlayers();
        }

        // Toggle customization panel
        function toggleCustomization() {
            const panel = document.getElementById('customizationPanel');
            panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
        }

        // Update data sources (refresh)
        async function updateDataSources() {
            document.getElementById('loadingIndicator').style.display = 'block';
            document.getElementById('mainContent').style.display = 'none';
            
            try {
                await loadPlayerData();
                renderPlayers();
                updateLastUpdatedTime();
            } catch (error) {
                console.error('Failed to refresh data:', error);
            } finally {
                document.getElementById('loadingIndicator').style.display = 'none';
                document.getElementById('mainContent').style.display = 'block';
            }
        }

        // Setup event listeners
        function setupEventListeners() {
            // Search and filter
            document.getElementById('searchInput').addEventListener('input', renderPlayers);
            document.getElementById('positionFilter').addEventListener('change', renderPlayers);
            
            // Customization
            document.getElementById('titleInput').addEventListener('input', function(e) {
                document.getElementById('systemTitle').textContent = e.target.value;
            });
            
            document.getElementById('colorSelect').addEventListener('change', function(e) {
                primaryColor = e.target.value;
                updateColorTheme();
            });
        }

        // Update color theme
        function updateColorTheme() {
            // Update active tab button color
            const activeTabButton = document.querySelector('.tab-button.bg-blue-600');
            if (activeTabButton) {
                activeTabButton.className = `tab-button px-4 py-2 rounded-lg font-medium bg-${primaryColor}-600 text-white`;
            }
        }

        // Auto-refresh data every 30 minutes
        setInterval(updateDataSources, 30 * 60 * 1000);

        // Initialize app when page loads
        document.addEventListener('DOMContentLoaded', initializeApp);
    </script>
</body>
</html>
                            ${activeTab !== 'draft' ? `
                                <button onclick="addToDKLineup('${player.name}')" class="text-green-600 hover:text-green-800 text-xs">
                                    Add to DK
                                </button>
                            ` :